<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle Financeiro</title>

<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  margin: 0;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 500px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

/* CABE√áALHO COM T√çTULO */
.header {
  text-align: center;
  margin-bottom: 20px;
}

.header h1 {
  color: #333;
  margin: 0 0 10px 0;
  font-size: 24px;
}

/* CALEND√ÅRIO VISUAL (HOJE) */
.calendario-hoje {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 20px;
  color: white;
  text-align: center;
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.data-hoje {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 5px;
}

.dia-semana-hoje {
  font-size: 18px;
  margin-bottom: 5px;
  opacity: 0.9;
}

.mes-ano-hoje {
  font-size: 16px;
  opacity: 0.8;
}

/* FORM */
.form-container {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  color: #555;
  font-size: 14px;
  font-weight: 500;
}

.form-row {
  display: flex;
  gap: 10px;
  align-items: center;
}

.form-row .form-group {
  flex: 1;
  margin-bottom: 0;
}

.form-row label {
  min-width: 100px;
  margin-bottom: 5px;
}

form input, form select, form button {
  width: 100%;
  padding: 12px;
  font-size: 14px;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-sizing: border-box;
  transition: border-color 0.3s ease;
}

form input:focus, form select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

form button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  padding: 14px;
  margin-top: 10px;
  transition: all 0.3s ease;
}

form button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

/* Bot√£o de edi√ß√£o diferente */
form button.editando {
  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
}

/* TIMELINE */
#timeline {
  margin-top: 20px;
}

.mes-titulo {
  font-weight: bold;
  margin: 20px 0 10px;
  color: #333;
  padding: 12px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 8px;
  text-align: center;
  font-size: 16px;
}

/* EVENTO */
.evento {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 12px;
  position: relative;
  font-size: 14px;
  border-left: 5px solid;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease;
}

.evento:hover {
  transform: translateX(5px);
}

.evento.recebimento { 
  border-left-color: #4CAF50;
  background: linear-gradient(to right, #f0f9f4, #ffffff);
}

.evento.gasto { 
  border-left-color: #f44336;
  background: linear-gradient(to right, #fdf2f0, #ffffff);
}

.data-evento {
  font-size: 12px;
  color: #666;
  margin-bottom: 5px;
}

.descricao-evento {
  font-weight: 500;
  color: #333;
  margin-bottom: 8px;
}

.valor {
  font-weight: bold;
  font-size: 16px;
}

.evento.recebimento .valor {
  color: #4CAF50;
}

.evento.gasto .valor {
  color: #f44336;
}

.saldo-acumulado {
  font-size: 12px;
  color: #666;
  margin-top: 5px;
}

/* MENU BOLINHA */
.menu-dot {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  position: absolute;
  top: 10px;
  right: 10px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f0f0f0;
  transition: all 0.3s ease;
}

.menu-dot:hover {
  background: #667eea;
  color: white;
  transform: rotate(90deg);
}

.menu-dot::after {
  content: '‚ãÆ';
  font-size: 20px;
  font-weight: bold;
}

.popup {
  display: none;
  position: absolute;
  right: 10px;
  top: 45px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 8px;
  z-index: 10;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  min-width: 120px;
}

.popup div {
  padding: 10px 15px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
  transition: background 0.2s ease;
}

.popup div:last-child {
  border-bottom: none;
}

.popup div:hover {
  background: #f0f0f0;
}

/* DIVIS√ÉO DE M√äS */
.divisao-mes {
  position: relative;
  margin: 25px 0;
  text-align: center;
}

.linha-divisoria {
  border-top: 2px dashed #ddd;
  position: absolute;
  top: 20px;
  left: 0;
  right: 0;
  z-index: 1;
}

.saldo-mes {
  display: inline-block;
  background: #fff;
  padding: 10px 25px;
  border-radius: 25px;
  font-size: 14px;
  font-weight: bold;
  position: relative;
  z-index: 2;
  margin: 10px 0;
  border: 2px solid;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.saldo-mes.positivo {
  color: #4CAF50;
  border-color: #4CAF50;
  background: linear-gradient(to right, #f0f9f4, #ffffff);
}

.saldo-mes.negativo {
  color: #f44336;
  border-color: #f44336;
  background: linear-gradient(to right, #fdf2f0, #ffffff);
}

/* MODO EDI√á√ÉO */
.form-container.editando {
  border: 2px solid #4CAF50;
  background: #f0f9f4;
}

.form-container.editando h3 {
  color: #4CAF50;
  margin-top: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-container h3 {
  margin: 0 0 15px 0;
  color: #333;
  font-size: 18px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.botoes-edicao {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.botoes-edicao button {
  flex: 1;
}

.btn-cancelar {
  background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%) !important;
}

/* NOTIFICA√á√ÉO */
.notificacao {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #4CAF50;
  color: white;
  padding: 15px 25px;
  border-radius: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  z-index: 1000;
  animation: slideIn 0.3s ease, fadeOut 0.3s ease 2s forwards;
  display: flex;
  align-items: center;
  gap: 10px;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes fadeOut {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

/* RESPONSIVIDADE */
@media (max-width: 600px) {
  .container {
    padding: 15px;
  }
  
  .form-row {
    flex-direction: column;
    gap: 15px;
  }
  
  .form-row label {
    min-width: auto;
  }
  
  .evento {
    padding: 12px;
  }
  
  .data-hoje {
    font-size: 28px;
  }
  
  .botoes-edicao {
    flex-direction: column;
  }
  
  .notificacao {
    top: 10px;
    right: 10px;
    left: 10px;
  }
}
</style>
</head>

<body>

<div class="container">

  <!-- CABE√áALHO -->
  <div class="header">
    <h1>üí∞ Controle Financeiro</h1>
    
    <!-- CALEND√ÅRIO VISUAL (APENAS HOJE) -->
    <div class="calendario-hoje">
      <div class="dia-semana-hoje" id="dia-semana-hoje">Sexta-feira</div>
      <div class="data-hoje" id="data-hoje">15</div>
      <div class="mes-ano-hoje" id="mes-ano-hoje">Mar√ßo 2024</div>
    </div>
  </div>

  <!-- FORM COM SELE√á√ÉO DE DATA -->
  <div class="form-container" id="form-container">
    <form id="form-lancamento" onsubmit="adicionar(event)">
      <h3 id="form-titulo">‚ûï Nova Transa√ß√£o</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="data-lancamento">üìÖ Data:</label>
          <input type="date" id="data-lancamento" required>
        </div>
        
        <div class="form-group">
          <label for="tipo">Tipo:</label>
          <select id="tipo">
            <option value="recebimento">üì• Recebimento</option>
            <option value="gasto">üì§ Gasto</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="valor">üí∞ Valor (R$):</label>
        <input type="number" id="valor" placeholder="0,00" step="0.01" min="0" required>
      </div>
      
      <div class="form-group">
        <label for="descricao">üìù Descri√ß√£o:</label>
        <input type="text" id="descricao" placeholder="Ex: Sal√°rio, Aluguel, Supermercado...">
      </div>
      
      <div class="botoes-edicao" id="botoes-edicao" style="display: none;">
        <button type="submit" class="editando">üíæ Salvar Edi√ß√£o</button>
        <button type="button" class="btn-cancelar" onclick="cancelarEdicao()">‚ùå Cancelar</button>
      </div>
      
      <button type="submit" id="btn-adicionar">üíæ Adicionar Transa√ß√£o</button>
    </form>
  </div>

  <!-- TIMELINE -->
  <div id="timeline"></div>

</div>

<script>
let eventos = [];
let editando = null;

// Elementos do DOM
const dataHojeElement = document.getElementById('data-hoje');
const diaSemanaHojeElement = document.getElementById('dia-semana-hoje');
const mesAnoHojeElement = document.getElementById('mes-ano-hoje');
const dataLancamentoInput = document.getElementById('data-lancamento');
const formContainer = document.getElementById('form-container');
const formTitulo = document.getElementById('form-titulo');
const btnAdicionar = document.getElementById('btn-adicionar');
const botoesEdicao = document.getElementById('botoes-edicao');

// CHAVE PARA O LOCALSTORAGE
const STORAGE_KEY = 'controle_financeiro_lancamentos';

/* FUN√á√ïES PARA SALVAR E CARREGAR DO LOCALSTORAGE */
function salvarEventos() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(eventos));
}

function carregarEventos() {
  const dadosSalvos = localStorage.getItem(STORAGE_KEY);
  if (dadosSalvos) {
    eventos = JSON.parse(dadosSalvos);
  }
}

/* FUN√á√ÉO PARA CORRIGIR O PROBLEMA DA DATA */
function corrigirDataParaExibicao(dataStr) {
  const partes = dataStr.split('-');
  if (partes.length === 3) {
    const ano = parseInt(partes[0]);
    const mes = parseInt(partes[1]) - 1;
    const dia = parseInt(partes[2]);
    return new Date(ano, mes, dia);
  }
  return new Date(dataStr);
}

function formatarDataParaInput(data) {
  const ano = data.getFullYear();
  const mes = (data.getMonth() + 1).toString().padStart(2, '0');
  const dia = data.getDate().toString().padStart(2, '0');
  return `${ano}-${mes}-${dia}`;
}

/* FUN√á√ÉO PARA MOSTRAR NOTIFICA√á√ÉO */
function mostrarNotificacao(mensagem, tipo = 'sucesso') {
  const cores = {
    sucesso: '#4CAF50',
    erro: '#f44336',
    info: '#2196F3'
  };
  
  const icones = {
    sucesso: '‚úÖ',
    erro: '‚ùå',
    info: '‚ÑπÔ∏è'
  };
  
  // Remover notifica√ß√µes anteriores
  document.querySelectorAll('.notificacao').forEach(n => n.remove());
  
  // Criar nova notifica√ß√£o
  const notificacao = document.createElement('div');
  notificacao.className = 'notificacao';
  notificacao.style.background = cores[tipo];
  notificacao.innerHTML = `${icones[tipo]} ${mensagem}`;
  
  document.body.appendChild(notificacao);
  
  // Remover automaticamente ap√≥s 3 segundos
  setTimeout(() => {
    if (notificacao.parentNode) {
      notificacao.remove();
    }
  }, 3000);
}

/* FUN√á√ïES PARA FORMATAR DATA */
function atualizarCalendarioHoje() {
  const hoje = new Date();
  
  // Formatar data atual (dia do m√™s)
  dataHojeElement.textContent = hoje.getDate();
  
  // Formatar dia da semana
  const diasSemana = ['Domingo', 'Segunda-feira', 'Ter√ßa-feira', 'Quarta-feira', 
                     'Quinta-feira', 'Sexta-feira', 'S√°bado'];
  diaSemanaHojeElement.textContent = diasSemana[hoje.getDay()];
  
  // Formatar m√™s e ano
  const meses = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
  mesAnoHojeElement.textContent = `${meses[hoje.getMonth()]} ${hoje.getFullYear()}`;
  
  // Definir data padr√£o para o campo de data (hoje)
  if (editando === null) {
    dataLancamentoInput.value = formatarDataParaInput(hoje);
  }
}

function nomeMes(m) {
  return ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho",
          "Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][m];
}

function getMesAno(dataStr) {
  const data = corrigirDataParaExibicao(dataStr);
  return {
    mes: data.getMonth(),
    ano: data.getFullYear(),
    mesAno: `${data.getFullYear()}-${data.getMonth()}`
  };
}

function formatarData(d) {
  const data = corrigirDataParaExibicao(d);
  const hoje = new Date();
  
  // Comparar datas corretamente (sem horas/minutos)
  const mesmaData = 
    data.getDate() === hoje.getDate() &&
    data.getMonth() === hoje.getMonth() &&
    data.getFullYear() === hoje.getFullYear();

  const texto = data.toLocaleDateString("pt-BR", {
    weekday: 'short',
    day: 'numeric',
    month: 'short'
  });
  
  return mesmaData ? `<span class="hoje">Hoje, ${data.toLocaleDateString("pt-BR")}</span>` : texto;
}

function entrarModoEdicao() {
  formContainer.classList.add('editando');
  formTitulo.textContent = '‚úèÔ∏è Editando Transa√ß√£o';
  formTitulo.innerHTML = '‚úèÔ∏è <span>Editando Transa√ß√£o</span>';
  btnAdicionar.style.display = 'none';
  botoesEdicao.style.display = 'flex';
}

function sairModoEdicao() {
  formContainer.classList.remove('editando');
  formTitulo.textContent = '‚ûï Nova Transa√ß√£o';
  formTitulo.innerHTML = '‚ûï <span>Nova Transa√ß√£o</span>';
  btnAdicionar.style.display = 'block';
  botoesEdicao.style.display = 'none';
  editando = null;
  
  // Limpar formul√°rio
  document.getElementById('form-lancamento').reset();
  dataLancamentoInput.value = formatarDataParaInput(new Date());
  tipo.value = "recebimento";
}

function cancelarEdicao() {
  sairModoEdicao();
  mostrarNotificacao('Edi√ß√£o cancelada', 'info');
}

function adicionar(e) {
  e.preventDefault();

  // Armazenar a data exatamente como veio do input
  const obj = {
    data: dataLancamentoInput.value,
    tipo: tipo.value,
    valor: parseFloat(valor.value),
    descricao: descricao.value
  };

  if (editando !== null) {
    // Modo edi√ß√£o: atualizar transa√ß√£o existente
    eventos[editando] = obj;
    mostrarNotificacao('Transa√ß√£o atualizada com sucesso!', 'sucesso');
  } else {
    // Modo adi√ß√£o: adicionar nova transa√ß√£o
    eventos.push(obj);
    mostrarNotificacao('Transa√ß√£o adicionada com sucesso!', 'sucesso');
  }

  // SALVAR NO LOCALSTORAGE
  salvarEventos();
  
  // Sair do modo edi√ß√£o (se estiver editando)
  sairModoEdicao();
  
  // Atualizar timeline
  renderizar();
}

function toggleMenu(i) {
  document.querySelectorAll(".popup").forEach(p=>p.style.display="none");
  const el = document.getElementById("menu-"+i);
  el.style.display = el.style.display === "block" ? "none" : "block";
}

function editar(i) {
  const e = eventos[i];
  
  // Preencher formul√°rio com dados da transa√ß√£o
  dataLancamentoInput.value = e.data;
  tipo.value = e.tipo;
  valor.value = e.valor;
  descricao.value = e.descricao;
  
  // Ativar modo edi√ß√£o
  editando = i;
  entrarModoEdicao();
  
  // Fechar menu popup
  document.querySelectorAll(".popup").forEach(p=>p.style.display="none");
  
  // Scroll para o formul√°rio
  document.querySelector('.form-container').scrollIntoView({ 
    behavior: 'smooth',
    block: 'center'
  });
  
  mostrarNotificacao('Modo edi√ß√£o ativado. Fa√ßa as altera√ß√µes necess√°rias.', 'info');
}

function excluir(i) {
  // Apenas para exclus√£o pedimos confirma√ß√£o
  if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?\nEsta a√ß√£o n√£o pode ser desfeita.')) {
    // Se estiver editando esta transa√ß√£o, cancelar edi√ß√£o primeiro
    if (editando === i) {
      sairModoEdicao();
    }
    
    eventos.splice(i,1);
    
    // SALVAR NO LOCALSTORAGE
    salvarEventos();
    
    renderizar();
    mostrarNotificacao('Transa√ß√£o exclu√≠da com sucesso!', 'sucesso');
  }
}

/* RENDERIZA√á√ÉO */
function renderizar() {
  const tl = document.getElementById("timeline");
  tl.innerHTML = "";

  if (eventos.length === 0) {
    tl.innerHTML = `
      <div style="text-align: center; padding: 40px 20px; color: #666;">
        <div style="font-size: 48px; margin-bottom: 20px;">üìä</div>
        <h3>Nenhuma transa√ß√£o ainda</h3>
        <p>Adicione sua primeira transa√ß√£o usando o formul√°rio acima!</p>
      </div>
    `;
    return;
  }

  // Ordenar por data
  eventos.sort((a,b)=>a.data.localeCompare(b.data));
  
  // Agrupar eventos por m√™s/ano
  const eventosPorMes = {};
  eventos.forEach((evento, index) => {
    const { mes, ano, mesAno } = getMesAno(evento.data);
    if (!eventosPorMes[mesAno]) {
      eventosPorMes[mesAno] = {
        mes,
        ano,
        eventos: [],
        saldo: 0
      };
    }
    eventosPorMes[mesAno].eventos.push({...evento, index});
  });

  // Calcular saldo acumulado por m√™s
  let saldoTotal = 0;
  const meses = Object.keys(eventosPorMes).sort();
  
  meses.forEach((mesAno, mesIndex) => {
    const grupo = eventosPorMes[mesAno];
    
    // Adicionar t√≠tulo do m√™s
    tl.innerHTML += `<div class="mes-titulo">${nomeMes(grupo.mes)} de ${grupo.ano}</div>`;
    
    // Adicionar eventos do m√™s
    grupo.eventos.forEach(item => {
      const evento = item;
      const i = item.index;
      
      // Atualizar saldo do m√™s
      if (evento.tipo === "recebimento") {
        grupo.saldo += evento.valor;
        saldoTotal += evento.valor;
      } else {
        grupo.saldo -= evento.valor;
        saldoTotal -= evento.valor;
      }

      // Destacar transa√ß√£o sendo editada
      const sendoEditada = editando === i ? 'style="border: 2px solid #667eea; background: #e8f4fc;"' : '';
      
      tl.innerHTML += `
        <div class="evento ${evento.tipo}" ${sendoEditada}>
          <div class="menu-dot" onclick="toggleMenu(${i})"></div>
          <div class="popup" id="menu-${i}">
            <div onclick="editar(${i})">‚úèÔ∏è Editar</div>
            <div onclick="excluir(${i})">üóëÔ∏è Excluir</div>
          </div>
          <div class="data-evento">${formatarData(evento.data)}</div>
          <div class="descricao-evento">${evento.descricao || "Sem descri√ß√£o"}</div>
          <div class="valor">${evento.tipo==="recebimento"?"+ ":"- "}R$ ${evento.valor.toFixed(2)}</div>
          <div class="saldo-acumulado">Saldo acumulado: R$ ${saldoTotal.toFixed(2)}</div>
        </div>
      `;
    });

    // Adicionar divis√£o entre meses (exceto ap√≥s o √∫ltimo m√™s)
    if (mesIndex < meses.length - 1) {
      const saldoClasse = grupo.saldo >= 0 ? "positivo" : "negativo";
      tl.innerHTML += `
        <div class="divisao-mes">
          <div class="linha-divisoria"></div>
          <div class="saldo-mes ${saldoClasse}">
            Saldo de ${nomeMes(grupo.mes)}: R$ ${grupo.saldo.toFixed(2)}
          </div>
        </div>
      `;
    }
  });

  // Adicionar saldo total no final
  if (eventos.length > 0) {
    const ultimoMes = eventosPorMes[meses[meses.length - 1]];
    const saldoClasse = ultimoMes.saldo >= 0 ? "positivo" : "negativo";
    tl.innerHTML += `
      <div class="divisao-mes">
        <div class="linha-divisoria"></div>
        <div class="saldo-mes ${saldoClasse}">
          Saldo final de ${nomeMes(ultimoMes.mes)}: R$ ${ultimoMes.saldo.toFixed(2)}
        </div>
      </div>
    `;
  }
}

/* INICIALIZA√á√ÉO */
document.addEventListener('DOMContentLoaded', () => {
  // CARREGAR DADOS SALVOS
  carregarEventos();
  
  // Inicializar calend√°rio visual (hoje)
  atualizarCalendarioHoje();
  
  // Atualizar automaticamente a cada minuto (para manter a hora correta)
  setInterval(atualizarCalendarioHoje, 60000);
  
  // Renderizar inicialmente
  renderizar();
});

// Fechar popups ao clicar fora
document.addEventListener('click', (e) => {
  if (!e.target.closest('.menu-dot') && !e.target.closest('.popup')) {
    document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
  }
});
</script>

</body>
</html>